<!DOCTYPE html>
<html dir="ltr" lang="en-US">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta http-equiv="x-ua-compatible" content="IE=edge" />
  <meta name="author" content="SemiColonWeb" />
  <meta name="description"
    content="Create Skincare Store &amp; Beauty Products Websites with Canvas Template. Get Canvas to build powerful websites easily with the Highly Customizable &amp; Best Selling Bootstrap Template, today." />

  <!-- Font Imports -->
  <!-- https://use.typekit.net/aay8rzy.css -->
  <link rel="stylesheet" href="https://use.typekit.net/aay8rzy.css" />

  <!-- Core Style -->
  <link rel="stylesheet" href="http://127.0.0.1:8082/style.css" />

  <!-- Font Icons -->
  <link rel="stylesheet" href="http://127.0.0.1:8082/css/font-icons.css" />

  <!-- Plugins/Components CSS -->
  <link rel="stylesheet" href="http://127.0.0.1:8082/css/swiper.css" />

  <!-- Niche Demos -->
  <link rel="stylesheet" href="http://127.0.0.1:8082/demos/skincare/skincare.css" />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="http://127.0.0.1:8082/css/custom.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Document Title
	============================================= -->
  <title>Single - Demo Skincare | Canvas</title>

  <style>
    /* Specific for This Page for Smooth Scrolling Product Image */
    @media (prefers-reduced-motion: no-preference) {
      :root {
        scroll-behavior: smooth;
      }
    }

    .device-touch .section-single-features {
      background-attachment: scroll !important;
    }
  </style>
</head>

<body class="stretched skincare-shop-single">
  <!-- Document Wrapper
	============================================= -->
  <div id="wrapper">
    <!-- Top Bar
		============================================= -->

    <!-- Header
		============================================= -->
    <header id="header" class="header-size-sm" data-sticky-shrink="false" style="border-color: var(--cnvs-color)">
      <div class="container">
        <div class="header-row justify-content-lg-between">
          <nav class="primary-menu top-primary-menu col-lg-5 order-last order-lg-first mobile-menu-off-canvas">
            <ul class="menu-container">
              <li class="menu-item">
                <a class="menu-link" href="demo-wenchuang.html">
                  <div>主页</div>
                </a>
              </li>
              <li class="menu-item">
                <a class="menu-link" href="demo-wenchuang-shop.html">
                  <div>产品</div>
                </a>
              </li>

              <li class="menu-item">
                <a class="menu-link" href="demo-wenchuang-cart.html">
                  <div>购物车</div>
                </a>
              </li> <li class="menu-item">
                <a class="menu-link" href="demo-wenchuang-checkout.html">
                  <div>订单</div>
                </a>
              </li>
            </ul>
          </nav>
          <!-- #primary-menu end -->

          <!-- Logo
					============================================= -->
          <div id="logo" class="mx-lg-auto col-lg-2 justify-content-center">
            <a class="color fst-italic" href="#">文创商城</a>
          </div>
          <!-- #logo end -->

          <div class="col-lg-5 d-flex justify-content-end">
            <div class="header-misc">
              <!-- #primary-menu end -->

              <div class="primary-menu-trigger" data-target=".top-primary-menu">
                <button class="cnvs-hamburger" type="button" title="Open Mobile Menu">
                  <span class="cnvs-hamburger-box"><span class="cnvs-hamburger-inner"></span></span>
                </button>
              </div>

              <!-- Top Account
							============================================= -->
              <div class="header-misc-icon me-lg-4">
                <a href="demo-wenchuang-login.html"><i class="bi-person-circle"></i></a>
              </div>
              <!-- top-Account end -->

              <!-- Top Cart
							============================================= -->
              <div id="top-cart" class="header-misc-icon me-lg-4">
                <a href="#" id="top-cart-trigger"><i class="bi-basket"></i></a>

              </div>
              <!-- #top-cart end -->

              <!-- Top Search
							============================================= -->
              <div id="top-search" class="header-misc-icon">
                <a href="#" id="top-search-trigger"><i class="uil uil-search"></i><i class="bi-x-lg"></i></a>
              </div>
              <!-- #top-search end -->
            </div>
          </div>

          <form class="top-search-form" action="search.html" method="get">
            <input type="text" name="q" class="form-control" value="" placeholder="Type &amp; Hit Enter.."
              autocomplete="off" />
          </form>
        </div>
      </div>

      <div id="header-wrap">
        <div class="container">
          <div class="header-row">
            <div class="primary-menu-trigger justify-content-start" data-target=".main-primary-menu">
              <button class="cnvs-hamburger" type="button" title="Open Mobile Menu">
                <span class="cnvs-hamburger-box"><span class="cnvs-hamburger-inner"></span></span>
              </button>
            </div>

            <!-- #primary-menu end -->
          </div>
        </div>
      </div>
      <div class="header-wrap-clone"></div>
    </header>
    <!-- #header end -->

    <!-- Hero
		============================================= -->
    <div class="container">
      <div class="row g-0 col-mb-50 swiper-vertical">
        <div class="col-md-6">
          <div class="row">
            <nav id="sticky-dots" class="d-none d-md-flex flex-column align-items-center col-auto one-page-menu"
              data-active-class="active" data-parent=".nav-link">
              <!-- 动态填充商品的图片 -->
              <a class="nav-link sticky-dot active" href="#item-1" data-href="#item-1">
                <i class="bi-circle"></i>
              </a>
            </nav>

            <div class="col scroll-container mt-5">
              <div class="masonry-thumbs grid-container row row-cols-3 row-cols-md-1 masonry-gap-xl"
                data-lightbox="gallery">
                <!-- 商品图片 -->
                <a :href="'http://localhost:8086/image/'+product.imagePath" id="item-1" class="page-section p-0"
                  data-lightbox="gallery-item" title="{{ product.productName }}">
                  <img :src="'http://localhost:8086/image/'+product.imagePath" alt="{{ product.productName }}" />
                </a>
              </div>
            </div>
          </div>
        </div>

        <nav class="col-md-6 skincare-shop-desc">
          <div class="p-md-4 p-lg-5">
            <div class="d-flex align-items-center justify-content-between">
              <p class="color text-uppercase ls-2 mb-3 small">
                {{ product.category }} <span class="mx-2">/</span>
              </p>

              <!-- 商品评分 -->
              <!-- <div class="product-rating">
                <i class="bi-star-fill color"></i>
                <i class="bi-star-fill color"></i>
                <i class="bi-star-fill color"></i>
                <i class="bi-star-fill color"></i>
                <i class="bi-star-half color"></i>
              </div> -->
            </div>

            <h2 class="fs-1 lh-sm">{{ product.productName }}</h2>

            <div class="line my-4" style="border-color: var(--cnvs-color)"></div>

            <!-- 显示价格 -->
            <div class="price-section">
              <p>
                <span class="original-price" style="text-decoration: line-through; color: #999;">${{ product.price
                  }}</span>
                <span class="discount-price">${{ product.discountPrice }}</span>
              </p>
            </div>

            <form class="cart cart-border cart-border-2 mb-0 d-flex flex-column flex-lg-row align-items-lg-center"
              method="post" enctype="multipart/form-data">
              <div class="quantity mb-2 mb-lg-0 me-2 me-lg-4 justify-content-between">
                <!-- 商品数量 -->
                <button type="button" class="minus" @click="updateQuantity(-1)">
                  <i class="uil uil-minus"></i>
                </button>
                <input type="number" step="1" min="1" v-model="quantity" title="Qty" class="qty border-0"
                  id="product-quantity" />
                <button type="button" class="plus" @click="updateQuantity(1)">
                  <i class="uil uil-plus"></i>
                </button>
              </div>
              <button type="button" class="add-to-cart button m-0 flex-fill text-white"
                style="--cnvs-btn-padding-y: 0.75rem" @click="addToCart">
                ${{ totalPrice }}<i class="bi-circle-fill small mx-3"></i>加入购物车
              </button>
            </form>


            <div class="line my-4" style="border-color: var(--cnvs-color)"></div>

            <p>{{ product.description }}</p>
            <div class="row mb-2">
              <span class="col-sm-3 fw-semibold">商品库存:</span>
              <span class="col-sm-9">{{ product.stock }} </span>
            </div>

            <div class="row mb-2">
              <span class="col-sm-3 fw-semibold">分类:</span>
              <span class="col-sm-9">{{ product.category }}</span>
            </div>
          </div>
        </nav>
      </div>
    </div>

    <!-- #content end -->
  </div>
  <!-- #wrapper end -->

  <!-- Go To Top
	============================================= -->
  <div id="gotoTop" class="uil uil-angle-up"></div>

  <!-- JavaScripts
	============================================= -->
  <script src="http://127.0.0.1:8082/js/plugins.min.js"></script>
  <script src="http://127.0.0.1:8082/js/functions.bundle.js"></script>

  <!-- 引入 Vue 和 Axios -->
  <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    // Vue 3 中使用 createApp 方法创建应用实例
    const app = Vue.createApp({
      data() {
        return {
          product: {},
          quantity: 1,       // 当前商品数量
          totalPrice: 0,     // 总价
        };
      },
      mounted() {
        this.fetchData();
      },
      methods: {
        addToCart() {
          // 从 localStorage 获取用户 ID
          var user = JSON.parse(localStorage.getItem('user'));

          if (!user) {
            // 如果用户未登录，弹出提示
            alert('请先登录');
            return;
          }

          // 构建 cart 对象
          const cart = {
            cartId: null, // 后端自动生成，通常不需要前端提供
            userId: user.userId, // 从 localStorage 获取用户 ID
            username: user.username, // 假设用户名保存在 localStorage
            productId: this.product.productId,
            productName: this.product.productName,
            productPrice: this.product.price,
            productDiscountPrice: this.product.discountPrice,
            productPriceDifference: this.product.price - this.product.discountPrice,
            productCategory: this.product.category,
            productImagePath: this.product.imagePath,
            quantity: this.quantity,
            createdAt: new Date().toISOString(), // 当前时间
            updatedAt: new Date().toISOString(), // 当前时间
          };

          // 发送 POST 请求到后端
          axios.post(`http://localhost:8086/cart/`, cart)
            .then(response => {
              // 请求成功时的处理逻辑
              alert('商品已成功添加到购物车');
            })
            .catch(error => {
              // 请求失败时的处理逻辑
              console.error('添加到购物车失败:', error);
              alert('添加到购物车失败，请稍后再试');
            });
        },
        // 更新商品数量的方法
        updateQuantity(change) {
          let newQuantity = this.quantity + change;

          // 确保数量不小于 1
          if (newQuantity < 1) {
            newQuantity = 1;
          }

          // 确保数量不超过库存数量
          if (newQuantity > this.product.stock) {
            newQuantity = this.product.stock;
          }

          // 更新数量
          this.quantity = newQuantity;
          // 计算总价
          this.totalPrice = this.quantity * this.product.discountPrice;
        },
        fetchData() {
          this.product = JSON.parse(localStorage.getItem("selectedProduct"));
          this.totalPrice = this.quantity * this.product.discountPrice;
          console.log("product", this.product.productId);

        },
      },
    });

    // 挂载到 DOM 元素上
    app.mount("#wrapper");
  </script>
</body>

</html>